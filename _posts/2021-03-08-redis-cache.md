---
title: "메인 페이지의 성능 개선을 위한 캐시 적용"
excerpt: "redis, cache"
comments: true

categories:
  - Project
last_modified_at: 2021-03-08
---

### 게임 조회 기능 시작!
웹 사이트의 첫번째 순서인 로그인과 회원 관리 기능을 구축한 후 본격적으로 db에 저장된 게임 목록을 가져오는 기능을 구현합니다.
메인 페이지는 정해진 틀에서 게임 리스트를 가져와 사용자에게 보여주는 역할을 합니다. 그리고 게임 리스트는 게임이 추가, 수정, 삭제가 되면 업데이트를 합니다.
드디어 메인 파트를 개발하는구나! 하고 신나게 SELECT 쿼리문을 작성하고 나자 문제점을 발견했습니다.   
아무리 간단한 쿼리문이라도 몇 천개 혹은 몇 만개의 데이터를 한꺼번에 불러와야 되고, 현 프로젝트는 동시다발적으로 사용자가 메인 페이지를 방문하는 서비스라는 가정 하에 작성하고 있습니다.
사용자가 점점 늘어나게 된다면 db에 엄청난 부하를 주면서 성능이 느려지는 문제가 생깁니다. 
몇 초의 로딩 시간에도 불만을 가질 수 있는데 만약 대기 시간이 길어진다면 사용자들은 더 나은 환경의 게임 사이트를 찾아 떠날 겁니다. 

<br>

처음에는 SELECT ALL 쿼리문에 LIMIT을 추가해 페이징 처리를 했습니다.
하지만 LIMIT은 정해진 데이터를 가져오기 위해 앞에 있는 데이터까지 우선적으로 읽어야 하기에 퍼포먼스 개선에 큰 도움은 되지 못합니다.
그래서 쿼리문 대신 다른 방법을 찾아나섰습니다.

<br>

게임이 변경되는 경우는 실시간 검색어만큼 잦은 변화가 없으니 어느 정도 정적 컨텐츠의 성격을 띈다고 봤습니다.
그렇다면 정적 컨텐츠를 DB보다 웹에 더 가까운 위치에 저장해 가져올 수 있다면 더 빠르게 데이터를 조달할 수 있게 됩니다.
그래서 DB와 웹 사이에 cache를 두기로 했습니다.

### Cache
캐시는 메모리에 있는 임시 저장소로 데이터나 복잡한 수학적 연산 결과를 미리 저장해 놓고 똑같은 요청이 있을 때마다 반환해주는 역할을 합니다. 
CPU 기능 부하를 줄여줄 수 있고 디스크에 있는 데이터를 계속해서 가져올 필요가 없기에 결과적으로 퍼포먼스 속도를 향상시킬 수 있습니다.      


### Redis vs. Memcached


### Redis로 결정
Cache를 적용하기 위해 Redis를 사용하기로 했습니다.
이미 Redis를 사용하고 있는 상태이고, Spring에서는 3.1 버전부터 cache를 기존에 있던 스프링 애플리케이션에 코드 변화 없이 적용할 수 있도록 해줍니다.
또한 Redis 4.0부터는 LFU(Least Frequently Used) 알고리즘이 도입됐습니다. 
해당 알고리즘은 가장 많이 사용되는 데이터를 메모리에 계속 남겨두는 방식으로 hits/misses ratio에 굉장히 효율적입니다. 
왜냐면 이전에 사용했던 LRU(Least Recently Used) 방식의 경우 최근에 사용되었더라도 자주 많이 사용되지 않은 데이터는 계속 메모리에 남게 되어 자리만 차지할 수 있습니다. 
게임 사이트는 메인 사이트 컨텐츠가 가장 많이 사용되기에 캐시로 LFU 방식이 더 효율적입니다.

### 적용


### 출처
1. https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#cache
2. https://docs.spring.io/spring-framework/docs/4.3.x/spring-framework-reference/html/cache.html
